@model CCS.Models.SAL.cs_comtModel
@using CCS.Models.SYS;
@using CCS.Core;
@using CCS.Common;
@{
    ViewBag.Title = "主頁";
    Layout = "~/Views/Shared/_Index_Layout.cshtml";
    List<permModel> perm = (List<permModel>)ViewBag.Perm;
    if (perm == null)
    {
        perm = new List<permModel>();
    }
}
<link href="~/Content/easyui-1.5/themes/blue/easyui.css" rel="stylesheet" />
<div class="mvctool">
    
    @Html.ToolButton("btnReturn", "icon-return", @Suggestion.Return, true)
    <input id="txtQuery" type="text" class="searchText" />
    @Html.ToolButton("btnQuery", "icon-search", @Suggestion.Query, true)
    @Html.ToolButton("btnCreate", "icon-add", @Suggestion.Create, perm, "Create", true)
    @Html.ToolButton("btnEdit", "icon-edit", @Suggestion.Edit, perm, "Edit", true)
    @Html.ToolButton("btnDetails", "icon-details", @Suggestion.Details, perm, "Details", true)
    @Html.ToolButton("btnDelete", "icon-remove", @Suggestion.Delete, perm, "Delete", true)
    @Html.ToolButton("btnExport", "icon-export", @Suggestion.Export, true)
    @Html.ToolButton("btnReload", "icon-reload", @Suggestion.Reload, true)

</div>
@*<table class="fromEditTable setTextWidth250" style="width:100%;" readinly="readonly">*@
<table class="" style="width:100%;">

    <tbody>
        <tr>
            <td style="width:100px; text-align:right;">
                @Html.LabelFor(model => model.VCH_NO)：
            </td>
            <td style="width:100px">
                @Html.EditorFor(model => model.VCH_NO, new { htmlAttributes = new { @class = "easyui-textbox", style = "width:200px;", @readonly = "readonly" } })
            </td>
            <td style="width:100px; text-align:right;">
                @Html.LabelFor(model => model.VCH_DT)：
            </td>
            <td style="width:100px">
                @Html.EditorFor(model => model.VCH_DT, new { htmlAttributes = new { @class = "easyui-datebox", style = "width:200px;", data_options = "formatter:myformatter,parser:myparser", @readonly = "readonly" } })
            </td>
            <td style="width:100px; text-align:right;">
                @Html.LabelFor(model => model.FA_NO)：
            </td>
            <td style="width:100px">
                <select id="FA_NO" name="FA_NO" class="easyui-combobox" style="width:200px;" readonly="readonly">
                    <option value="關廟廠">關廟廠</option>
                </select>
                @*@Html.EditorFor(model => model.FA_NO)*@
            </td>
        </tr>

        <tr>

            <td style="width:100px; text-align:right;">
                @Html.LabelFor(model => model.DEPM_NO)：
            </td>
            <td style="width:100px">
                <select id="DEPM_NO" name="DEPM_NO" class="easyui-combobox" style="width:200px;" readonly="readonly">
                    <option value="業務課">業務課</option>
                </select>
                @*@Html.EditorFor(model => model.DEPM_NO)*@
            </td>
            <td style="width:100px; text-align:right;">
                @Html.LabelFor(model => model.EMP_NO)：
            </td>
            <td style="width:100px">
                @Html.EditorFor(model => model.EMP_NO, new { htmlAttributes = new { @class = "easyui-textbox", style = "width:200px;", @readonly = "readonly" } })
            </td>
            <td style="width:100px; text-align:right;">
                @Html.LabelFor(model => model.EMP_NAME)：
            </td>
            <td style="width:100px">
                @Html.EditorFor(model => model.EMP_NAME, new { htmlAttributes = new { @class = "easyui-textbox", style = "width:200px;", @readonly = "readonly" } })
            </td>
        </tr>

        <tr>
            <td style="width:100px; text-align:right;">
                @Html.LabelFor(model => model.CS_NO)：
            </td>
            <td style="width:100px">
                @Html.EditorFor(model => model.CS_NO, new { htmlAttributes = new { @class = "easyui-textbox", style = "width:200px;", @readonly = "readonly" } })
            </td>
            <td style="width:100px; text-align:right;">
                @Html.LabelFor(model => model.CS_NM)：
            </td>
            <td style="width:100px">
                @Html.EditorFor(model => model.CS_NM, new { htmlAttributes = new { @class = "easyui-textbox", style = "width:200px;", @readonly = "readonly" } })
            </td>
            <td style="width:100px; text-align:right;">
                @Html.LabelFor(model => model.CONTACTER)：
            </td>
            <td style="width:200px">
                @Html.EditorFor(model => model.CONTACTER, new { htmlAttributes = new { @class = "easyui-textbox", style = "width:200px;", @readonly = "readonly" } })
            </td>
        </tr>

        <tr>

            <td style="width:100px; text-align:right;">
                @Html.LabelFor(model => model.TO_ADDR)：
            </td>
            <td style="width:200px">
                @Html.EditorFor(model => model.TO_ADDR, new { htmlAttributes = new { @class = "easyui-textbox", Style = "width:250px", @readonly = "readonly" } })
            </td>
            <td style="width:100px; text-align:right;">
                @Html.LabelFor(model => model.TEL_NO)：
            </td>
            <td style="width:200px">
                @Html.EditorFor(model => model.TEL_NO, new { htmlAttributes = new { @class = "easyui-textbox", style = "width:200px;", @readonly = "readonly" } })
            </td>
            <td style="width:100px; text-align:right;">
                @Html.LabelFor(model => model.FAX_NO)：
            </td>
            <td style="width:200px">
                @Html.EditorFor(model => model.FAX_NO, new { htmlAttributes = new { @class = "easyui-textbox", style = "width:200px;", @readonly = "readonly" } })
            </td>
        </tr>

        <tr></tr>

        <tr>
            <td style="width:100px; text-align:right;">
                @Html.LabelFor(model => model.CS_VCH_NO)：
            </td>
            <td style="width:200px">
                @Html.EditorFor(model => model.CS_VCH_NO, new { htmlAttributes = new { @class = "easyui-textbox", style = "width:200px;", @readonly = "readonly" } })
            </td>
            <td style="width:100px; text-align:right;">
                @Html.LabelFor(model => model.TAX_TY)：
            </td>
            <td style="width:200px">
                <select id="CURRENCY" name="CURRENCY" class="easyui-combobox" style="width:200px;" readonly="readonly">
                    <option value="應稅外加">應稅外加</option>
                    <option value="應稅內含">應稅內含</option>
                </select>
                @*@Html.EditorFor(model => model.TAX_TY)*@
            </td>
            <td style="width:100px; text-align:right;">
                @Html.LabelFor(model => model.TAX_RT)：
            </td>
            <td style="width:200px">
                @Html.EditorFor(model => model.TAX_RT, new { htmlAttributes = new { @class = "easyui-textbox", style = "width:200px;", @readonly = "readonly" } })
            </td>
        </tr>

        <tr>

            <td style="width:100px; text-align:right;">
                @Html.LabelFor(model => model.CURRENCY)：
            </td>
            <td style="width:200px">
                <select id="CURRENCY" name="CURRENCY" class="easyui-combobox" style="width:200px;" readonly="readonly">
                    <option value="NTD">NTD</option>
                    <option value="RMB">RMB</option>
                    <option value="USD">USD</option>
                </select>
                @*@Html.EditorFor(model => model.CURRENCY)*@
            </td>
            <td style="width:100px; text-align:right;">
                @Html.LabelFor(model => model.EXCH_RATE)：
            </td>
            <td style="width:200px">
                @Html.EditorFor(model => model.EXCH_RATE, new { htmlAttributes = new { @class = "easyui-textbox", style = "width:200px;", @readonly = "readonly" } })
            </td>
            <td style="width:100px; text-align:right;">
                @Html.LabelFor(model => model.WAHO_NO)：
            </td>
            <td style="width:200px">
                <select id="WAHO_NO" name="WAHO_NO" class="easyui-combobox" style="width:200px;" readonly="readonly">
                    <option value="出貨倉">出貨倉</option>
                </select>
                @*@Html.EditorFor(model => model.WAHO_NO)*@
            </td>
        </tr>

        <tr>
            <td style="width:100px; text-align:right;">
                @Html.LabelFor(model => model.SHIP_TY)：
            </td>
            <td style="width:200px">
                <select id="SHIP_TY" name="SHIP_TY" class="easyui-combobox" style="width:200px;" readonly="readonly">
                    <option value="陸運">陸運</option>
                    <option value="海運">海運</option>
                    <option value="空運">空運</option>
                </select>
                @*@Html.EditorFor(model => model.SHIP_TY)*@
            </td>
            <td style="width:100px; text-align:right;">
                @Html.LabelFor(model => model.SHIP_CORP)：
            </td>
            <td style="width:200px">
                @Html.EditorFor(model => model.SHIP_CORP, new { htmlAttributes = new { @class = "easyui-textbox", style = "width:200px;", @readonly = "readonly" } })
            </td>
            <td style="width:100px; text-align:right;">
                @Html.LabelFor(model => model.REMK)：
            </td>
            <td style="width:400px" colspan="2">
                @Html.EditorFor(model => model.REMK, new { htmlAttributes = new { @class = "easyui-textbox", style = "width:300px;", name = "CS_NO", multiline = "true", @readonly = "readonly" } })
            </td>
        </tr>



    </tbody>
</table>

    <table id="List"></table>

    <div id="modalwindow" class="easyui-window" data-options="modal:true,closed:true,minimizable:false,shadow:false"></div>
    @section scripts{

        <script type="text/javascript">


            $(function () {
                $('#List').datagrid({
                    url: '@Url.Action("GetList")?queryStr=@Model.VCH_NO',
                    width: $(window).width() - 10,
                    methord: 'post',
                    height: $(window).height() - 230,
                    fitColumns: true,
                    sortName: 'VCH_SR',
                    sortOrder: 'desc',
                    idField: 'ID',
                    pageSize: 20,
                    pageList: [15, 20, 30, 40, 50],
                    pagination: true,
                    striped: true, //奇偶行是否區分
                    singleSelect: true,//單選模式
                    //rownumbers: true,//行號
                    emptyMsg: '無資料',
                    loadMsg: '正在讀取中，請稍候...',
                    columns: [[
                        { field: 'ID', title: '', width: 50, sortable: true, hidden: true },
                        { field: 'VCH_NO', title: '訂單號碼', width: 50,  hidden: true },
                        { field: 'VCH_SR', title: '序號', width: 30, sortable: true },
                        { field: 'ITEM_NO', title: '品號', width: 140, sortable: true },
                        { field: 'ITEM_NM', title: '品名', width: 80, sortable: true },
                        { field: 'ITEM_SP', title: '規格', width: 80, sortable: true },
                        { field: 'CS_ITEM_NO', title: '客戶品號', width: 80, sortable: true },
                        { field: 'UNIT', title: '單位', width: 50, sortable: true },
                        { field: 'QTY', title: '數量', width: 50, sortable: true },
                        { field: 'PRC', title: '單價', width: 50, sortable: true },
                        { field: 'AMT', title: '金額', width: 50, sortable: true },
                        { field: 'PRCV_DT', title: '預定交期', width: 80, sortable: true },
                        { field: 'RCV_QTY', title: '已交數量', width: 50, sortable: true },
                        { field: 'C_CLS', title: '結案碼', width: 30, sortable: true }

                    ]]
                });
                var pager = $('#List').datagrid('getPager');
                $(pager).pagination({
                    pageSize: 20,
                    showPageList: true,
                    pageList: [15, 20, 30, 40, 50],
                    beforePageText: '第',
                    afterPageText: '頁,共{pages}頁',
                    displayMsg: '顯示 {from} 到 {to} 筆資料,共 {total} 筆資料'
                });
            });
           

            //ifram 返回
            function frameReturnByClose() {
                $("#modalwindow").window('close');
            }
            function frameReturnByReload(flag) {
                if (flag)
                    $("#List").datagrid('load');
                else
                    $("#List").datagrid('reload');
            }
            function frameReturnByMes(mes) {
                $.messageBox5s('提示', mes);
            }

            $(function () {
                $("#btnReturn").click(function () {
                    history.go(-1);
                });
                $("#btnReload").click(function () {
                    frameReturnByReload();
                });

                $("#btnExport").click(function () {
                    $("#modalwindow").html("<iframe width='100%' height='98%' scrolling='no' frameborder='0'' src='/Sales/SAL02/Reporting?ID=@Model.VCH_NO&Ieguid=" + GetGuid() + "'></iframe>");
                    $("#modalwindow").window({ title: '匯出', width: 800, height: 600, iconCls: 'icon-add' }).window('open');
                });
                $("#btnCreate").click(function () {
                    $("#modalwindow").html("<iframe width='100%' height='99%' scrolling='auto' frameborder='0'' src='/Sales/SAL02/Create?ID=@Model.VCH_NO&Ieguid=" + GetGuid() + "'></iframe>");
                    $("#modalwindow").window({ title: '新增', width: 800, height: 460, iconCls: 'icon-add' }).window('open');
                });
                $("#btnEdit").click(function () {
                    var row = $('#List').datagrid('getSelected');
                    if (row != null) {
                        $("#modalwindow").html("<iframe width='100%' height='99%'  frameborder='0' src='/Sales/SAL02/Edit?id=" + row.ID + "&Ieguid=" + GetGuid() + "'></iframe>");
                        $("#modalwindow").window({ title: '編輯', width: 800, height: 460, iconCls: 'icon-edit' }).window('open');
                    } else { $.messageBox5s('提示', '@Suggestion.PlaseChooseToOperatingRecords'); }
                });
                $("#btnDetails").click(function () {
                    var row = $('#List').datagrid('getSelected');
                    if (row != null) {
                        $("#modalwindow").html("<iframe width='100%' height='99%' scrolling='no' frameborder='0' src='/Sales/SAL02/Details?id=" + row.ID + "&Ieguid=" + GetGuid() + "'></iframe>");
                        $("#modalwindow").window({ title: '詳細', width: 800, height: 460, iconCls: 'icon-details' }).window('open');
                    } else { $.messageBox5s('提示', '@Suggestion.PlaseChooseToOperatingRecords'); }
                });
                $("#btnQuery").click(function () {
                    var queryStr = $("#txtQuery").val();
                    if (queryStr == null) {
                        queryStr = "%";
                    }
                    $('#List').datagrid({
                        url: '@Url.Action("GetList")?queryStr=' + encodeURI(queryStr)
                    });

                });
                $("#btnDelete").click(function () {
                    var row = $('#List').datagrid('getSelected');
                    if (row != null) {
                        $.messager.confirm('提示', '@Suggestion.YouWantToDeleteTheSelectedRecords', function (r) {
                            if (r) {
                                $.post("@Url.Action("Delete")?id=" + row.ID, function (data) {
                                    if (data.type == 1)
                                        $("#List").datagrid('load');
                                    $.messageBox5s('提示', data.message);
                                }, "json");

                            }
                        });
                    } else { $.messageBox5s('提示', '@Suggestion.PlaseChooseToOperatingRecords'); }
                });
            });

            function myformatter(date) {
                var y = date.getFullYear();
                var m = date.getMonth() + 1;
                var d = date.getDate();
                return y + '-' + (m < 10 ? ('0' + m) : m) + '-' + (d < 10 ? ('0' + d) : d);
            }
            function myparser(s) {
                if (!s) return new Date();
                var ss = (s.split('-'));
                var y = parseInt(ss[0], 10);
                var m = parseInt(ss[1], 10);
                var d = parseInt(ss[2], 10);
                if (!isNaN(y) && !isNaN(m) && !isNaN(d)) {
                    return new Date(y, m - 1, d);
                } else {
                    return new Date();
                }
            }

            $(window).resize(function () {
                $('#List').datagrid('resize', {
                    width: $(window).width() - 5,
                    height: SetGridHeightSub(225)
                }).datagrid('resize', {
                    width: $(window).width() - 5,
                    height: SetGridHeightSub(225)
                });
            });
            function SetGridWidthSub(w) {
                return $(window).width() - w;
            }
            function SetGridHeightSub(h) {
                return $(window).height() - h
            }


        </script>
    }
